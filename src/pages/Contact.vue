<template>
  <SideNavLayout :navActiveInfo="4">
    <NavLayout :navInfo="navInfo">
      <main class="relative">
        <div class="container h-full w-full pt-12 mt-12 md:mt-0">
          <div class="w-full block md:flex px-12">
            <div class="w-full lg:w-9/12">
              <h1 class="decor text-layout-b2 mt-0">Got some awesome idea?</h1>

              <p class="kicker">
                Please feel free to reach out. I'm up for new challenges!
              </p>

              <figure class="w-full my-8">
                <svg
                  class="mx-auto w-1/2"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 307.902 270"
                >
                  <g transform="translate(-.399 -.509)">
                    <ellipse
                      cx="111.724"
                      cy="19.737"
                      rx="111.724"
                      ry="19.737"
                      transform="translate(60.371 231.034)"
                      fill="#3f3d56"
                    />
                    <path
                      d="M97.743 122.978a53.2 53.2 0 10-24.684 19.819 17.209 17.209 0 1024.684-19.819z"
                      fill="#11a89d"
                    />
                    <path
                      fill="#fff"
                      d="M21.904 82.643h63.284v4.996H21.904zM21.904 90.97h63.284v4.996H21.904zM21.904 99.297h63.284v4.996H21.904z"
                    />
                    <path
                      d="M210.956 83.404a53.2 53.2 0 1124.684 19.823 17.209 17.209 0 11-24.684-19.819z"
                      fill="#11a89d"
                    />
                    <path
                      fill="#fff"
                      d="M286.795 48.065h-63.284v-4.996h63.284zM286.795 56.392h-63.284v-4.996h63.284zM286.795 64.719h-63.284v-4.996h63.284z"
                    />
                    <path
                      d="M118.574 229.02a29.7 29.7 0 1113.781 11.065 9.607 9.607 0 11-13.781-11.065z"
                      fill="#11a89d"
                    />
                    <circle
                      cx="3.437"
                      cy="3.437"
                      r="3.437"
                      transform="translate(128.115 208.326)"
                      fill="#fff"
                    />
                    <circle
                      cx="3.437"
                      cy="3.437"
                      r="3.437"
                      transform="translate(139.842 208.326)"
                      fill="#fff"
                    />
                    <circle
                      cx="3.437"
                      cy="3.437"
                      r="3.437"
                      transform="translate(151.569 208.326)"
                      fill="#fff"
                    />
                    <path
                      d="M146.721 105.134s15.336.417 17.869 1.338 3.665 7.511 3.665 7.511l-11.907 3.743-8.906-.5-6.7.474 3.743-9.8z"
                      fill="#2f2e41"
                    />
                    <path
                      d="M147.382 100.102s1.009 3.9-1.23 6.656 9.627 12.592 9.627 12.592l6.26-1.076s-1.38-11.974.474-15.006-15.131-3.166-15.131-3.166z"
                      fill="#9f616a"
                    />
                    <path
                      d="M147.382 100.102s1.009 3.9-1.23 6.656 9.627 12.592 9.627 12.592l6.26-1.076s-1.38-11.974.474-15.006-15.131-3.166-15.131-3.166z"
                      opacity=".1"
                    />
                    <path
                      d="M189.015 214.041l-13.812 18.317 9.426 5.5 12.973-21.225z"
                      fill="#9f616a"
                    />
                    <path
                      d="M179.327 232.667s-5.086-5.91-4.86-4.592-3.619 12.494-.041 13.575 34.26 3.948 34.682.484-9.153-5.889-9.153-5.889-5.688-5.467-6.95-4.911-13.678 1.333-13.678 1.333z"
                      fill="#2f2e41"
                    />
                    <path
                      d="M185.916 231.534l11.037 18.795 8.329-4.823-11.129-15.388z"
                      fill="#9f616a"
                    />
                    <path
                      d="M203.334 186.819l-3.274 4.633s-15.609 21.678-13.951 23.428 8.561 8.365 12.072 7.084 15.984-23.439 15.984-23.439l-3.254-13.009z"
                      fill="#2f2e41"
                    />
                    <path
                      d="M136.093 182.434a19.829 19.829 0 0012.355 8.731c8.86 2.208 18.116 6.723 18.445 6.667s1.261-.556 1.488.762 2.656 3.614 2.656 3.614 9.786 33.256 13.524 33.292 11.418-2.641 11.578-3.686-11.444-35.006-11.557-35.665l-1.359-7.907s15.346 2.45 16.777 2.883 14.162 7.4 14.162 7.4 12.978-9.354.839-18.8-33-16.376-33-16.376l-7.485-2.105-6.524-.389-.961-3.683-15.45.891-16.126 6.838z"
                      fill="#2f2e41"
                    />
                    <circle
                      cx="12.035"
                      cy="12.035"
                      r="12.035"
                      transform="translate(144.45 83.789)"
                      fill="#9f616a"
                    />
                    <path
                      d="M145.596 105.497l1.447-.249s2.614 10.066 10.7 11.729c0 0 3.991-4.781 3.82-5.587s3.16-5.11 4.931-2.7-.432 44.849 1.055 45.611 4.68 1.57 2.111 4.386-12.772 6.6-15.032 5.3-6.878-12.386-8.875-16.113-5.194-16.407-5.194-16.407-4.082-13.884-1.57-17.029 6.607-8.941 6.607-8.941z"
                      fill="#d0cde1"
                    />
                    <path
                      d="M157.114 157.745a68.667 68.667 0 01-1.379 8.789c-.59 2.357-1.277 3.78-2.062 3.719-2-.15-2.911 2.785-3.38 6.169-.5 3.59-.5 7.685-.776 9.132-.364 1.912-2.692 3.372-7.345 2.943a32.835 32.835 0 01-8.093-1.985c-6.282-2.284-6.1-20.807-5.045-34.553.643-8.425 1.609-15.059 1.609-15.059a74.8 74.8 0 01-2.519-9.593 12.765 12.765 0 01-.182-2.155c.093-3.408 6.315-12.617 10.074-18.354s8.9-1.528 8.9-1.528l-1.787 5.393s2.769 4.273 2.789 8.34 6.63 7 9 8.971c1.494 1.238 1.457 17.752.196 29.771zM162.34 107.198s.434.513 2.42.263c2.382-.3 5.656.524 6.417 2.8 1.4 4.17 5.328 21.132 5.328 21.132s1.637 19.392 2.373 23.675.371 8.077 1.1 10.327-7.166-4.2-10.075-3.356-4.777-10.033-4.412-13.827.674-7.918-.335-11.815.78-14.211.713-16.574-6.416-8.32-3.529-12.625z"
                      fill="#2f2e41"
                    />
                    <path
                      d="M170.856 167.47s12.743 6.952 13.962 16.846-17.044-9.581-17.044-9.581zM178.13 160.453s3.9 19.681 9.987 18.636-3.4-19.768-3.4-19.768z"
                      fill="#9f616a"
                    />
                    <path
                      d="M198.96 246.252s-3.115 3.588-3.887 3.042-2.548 6.883-.947 8.3 7.768 3.753 7.835 6.116 16.607 1.894 17.2-.582-2.075-8.123-3.948-9.158-8.8-10.558-8.8-10.558-5.43.797-7.453 2.84z"
                      fill="#2f2e41"
                    />
                    <path
                      d="M168.825 179.506c-2.955-2.086-11.206-2.6-18.531-3.085-3.214-.206-6.25-.408-8.583-.736-2.248-.311-4.269-2.365-6.064-5.425-2.721-4.637-4.92-11.59-6.614-18.3.643-8.425 1.609-15.059 1.609-15.059a74.79 74.79 0 01-2.519-9.593 5.134 5.134 0 011.625-1.463c7.77-3.335 15.188 29.487 16.13 34.637.016.085.028.166.04.234.457 2.652 5.393 4.92 9.816 5.817 2.725.554 5.26.59 6.428-.129 3.068-1.884 12.5 5.656 13.219 5.87s-2.311 10.236-6.556 7.232z"
                      opacity=".1"
                    />
                    <path
                      d="M129.751 123.823s-5.647 2.667-3.166 15.13 7.48 33.652 15.125 34.713 22.867.818 27.114 3.82 7.274-7.017 6.558-7.233-10.152-7.753-13.22-5.869-15.506-1.405-16.242-5.688-8.272-38.265-16.169-34.873zM170.446 117.847l6.207 14.4s.625-.312 1.351 1.938 1.066 4.226 2.337 5.7 6.929 22.553 7.1 23.542-7.814 4.4-9.6 1.65-7.395-47.23-7.395-47.23zM149.637 95.656c.461-.123.529-.736.544-1.213.083-2.555 1.621-5.177 4.067-5.921a6.838 6.838 0 012.882-.159 10.918 10.918 0 013.9 1.3 6.088 6.088 0 001.984.9c.477.072 2.543.673 3.018.758 1.045.186 2.016 1.121 3.018.773.959-.333 1.171-1.575 1.195-2.589.053-2.312-1.7-5.512-3.249-7.232a8.066 8.066 0 00-4.667-2.221 31.07 31.07 0 00-6.1-.371 19.393 19.393 0 00-8.1 1.458c-2.492 1.2-4.585 3.576-4.7 6.337-.025.575.034 1.153-.014 1.727-.118 1.4-.861 2.664-1.21 4.024a7.364 7.364 0 001.028 5.885c.925 1.361 2.378 2.592 2.325 4.237l2.005-2.078a1.647 1.647 0 00.49-2.012l-.71-2.769a2.5 2.5 0 01-.061-1.541c.763-1.878 1.586.913 2.355.707z"
                      fill="#2f2e41"
                    />
                    <path
                      d="M240.775 234.121c-.083-.136-2.043-3.408-2.722-10.2-.623-6.234-.222-16.741 5.227-31.4 10.323-27.766-2.379-50.17-2.509-50.393l.627-.364a55.612 55.612 0 015.247 14.864 64.847 64.847 0 01-2.686 36.145c-10.306 27.719-2.644 40.841-2.565 40.971z"
                      fill="#3f3d56"
                    />
                    <circle
                      cx="4.708"
                      cy="4.708"
                      r="4.708"
                      transform="translate(232.031 131.081)"
                      fill="#11a89d"
                    />
                    <circle
                      cx="4.708"
                      cy="4.708"
                      r="4.708"
                      transform="translate(246.879 148.464)"
                      fill="#3f3d56"
                    />
                    <circle
                      cx="4.708"
                      cy="4.708"
                      r="4.708"
                      transform="translate(236.739 160.053)"
                      fill="#11a89d"
                    />
                    <circle
                      cx="4.708"
                      cy="4.708"
                      r="4.708"
                      transform="translate(249.052 169.831)"
                      fill="#11a89d"
                    />
                    <circle
                      cx="4.708"
                      cy="4.708"
                      r="4.708"
                      transform="translate(233.117 185.041)"
                      fill="#3f3d56"
                    />
                    <path
                      d="M243.62 234.293s-4.708-11.589 9.416-20.281zM237.83 234.083s-2.143-12.326-18.73-12.218z"
                      fill="#3f3d56"
                    />
                  </g>
                </svg>
              </figure>

              <form
                class="w-full h-inherit bg-white shadow-xs p-8 rounded-sm text-layout-b1 text-sm lg:text-xs relative"
              >
                <div
                  v-if="loading"
                  class="absolute flex justify-center w-full h-full top-0 left-0 bg-gray-100 opacity-50"
                >
                  <clip-loader
                    class="self-center"
                    :loading="true"
                    :color="$static.metadata.brandColors.brand"
                    :size="'80px'"
                  ></clip-loader>
                </div>
                <div class="block w-full">
                  <button
                    @click.prevent="
                      resetForm()
                      clearFormErrors()
                    "
                    title="Reset"
                    class="bg-white hover:bg-gray-200 text-brand rounded px-4 py-1 my-2 font-bold transition duration-300 ease-out border pull-right focus:outline-none"
                  >
                    <unicon
                      class="flex-1 self-center"
                      width="10"
                      height="10"
                      name="redo"
                      :fill="$static.metadata.brandColors.brand"
                    ></unicon>
                  </button>
                </div>

                <div class="block w-full mb-4 leading-snug">
                  <select
                    id="category"
                    class="w-full px-4 py-3 border rounded focus:outline-none focus:border-brand"
                    :class="{ 'border-red-400': formErrors.category.hasError }"
                    @change="clearError"
                    v-model="form.category"
                  >
                    <option class="text-layout-w2" value="0" selected disabled
                      >Category</option
                    >
                    <option
                      v-for="type in messageType"
                      :key="type.id"
                      :value="type.id"
                      >{{ type.text }}</option
                    >
                  </select>
                  <span
                    v-if="formErrors.category.error"
                    class="text-red-400 text-xxs"
                    >{{ formErrors.category.error }}</span
                  >
                </div>

                <div class="block w-full mb-4 leading-snug">
                  <input
                    id="nickname"
                    class="w-full px-4 py-3 border rounded focus:outline-none focus:border-brand"
                    :class="{ 'border-red-400': formErrors.nickname.hasError }"
                    @change="clearError"
                    type="text"
                    placeholder="Nickname *"
                    v-model="form.nickname"
                  />
                  <span
                    v-if="formErrors.nickname.error"
                    class="text-red-400 text-xxs"
                    >{{ formErrors.nickname.error }}</span
                  >
                </div>

                <div class="flex w-full mb-4 leading-snug">
                  <div class="w-2/4 pr-3">
                    <input
                      id="email"
                      class="w-full px-4 py-3 border rounded focus:outline-none focus:border-brand"
                      :class="{ 'border-red-400': formErrors.email.hasError }"
                      @change="clearError"
                      type="text"
                      placeholder="Email *"
                      v-model="form.email"
                    />
                    <span
                      v-if="formErrors.email.error"
                      class="text-red-400 text-xxs"
                      >{{ formErrors.email.error }}</span
                    >
                  </div>
                  <div class="w-2/4 pl-3">
                    <input
                      id="contactNo"
                      class="w-full px-4 py-3 border rounded focus:outline-none focus:border-brand"
                      :class="{
                        'border-red-400': formErrors.contactNo.hasError,
                      }"
                      @change="clearError"
                      type="text"
                      placeholder="Contact No (optional)"
                      v-model="form.contactNo"
                    />
                    <span
                      v-if="formErrors.contactNo.error"
                      class="text-red-400 text-xxs"
                      >{{ formErrors.contactNo.error }}</span
                    >
                  </div>
                </div>

                <div class="block w-full leading-snug">
                  <textarea
                    id="message"
                    class="w-full px-4 py-3 border rounded focus:outline-none focus:border-brand"
                    :class="{ 'border-red-400': formErrors.message.hasError }"
                    @change="clearError"
                    cols="50"
                    rows="10"
                    placeholder="Say hi!"
                    v-model="form.message"
                  >
                  </textarea>
                  <span
                    v-if="formErrors.message.error"
                    class="text-red-400 text-xxs"
                    >{{ formErrors.message.error }}</span
                  >
                </div>

                <div class="block w-full mt-4">
                  <button
                    @click.prevent="sendForm"
                    type="submit"
                    class="bg-white hover:bg-brand text-brand hover:text-layout-w1 rounded px-6 py-2 mt-2 font-semibold transition duration-300 ease-out border focus:outline-none"
                  >
                    Submit
                  </button>
                </div>
              </form>
            </div>
            <div class="w-full md:w-3/12"></div>
          </div>

          <CustomFooter></CustomFooter>
        </div>
      </main>
    </NavLayout>
  </SideNavLayout>
</template>

<static-query>
query {
  metadata {
    brandColors {
      brand,
      layoutW1,
      layoutB2
    }
  }
}
</static-query>

<script>
import NavLayout from '~/layouts/NavLayout.vue'
import SideNavLayout from '~/layouts/SideNavLayout.vue'

import CustomFooter from '~/components/CustomFooter.vue'
import CustomNotif from '~/components/CustomNotif.vue'

import ClipLoader from 'vue-spinner/src/ClipLoader.vue'
import axios from 'axios'
import qs from 'qs'

export default {
  name: 'Contact',
  components: {
    NavLayout,
    SideNavLayout,
    CustomFooter,
    ClipLoader,
  },
  data() {
    return {
      loading: false,
      form: {
        category: 0,
        nickname: '',
        email: '',
        contactNo: '',
        message: '',
      },
      formErrors: {
        category: {
          hasError: false,
          error: ' ',
        },
        nickname: {
          hasError: false,
          error: ' ',
        },
        email: {
          hasError: false,
          error: ' ',
        },
        contactNo: {
          hasError: false,
          error: ' ',
        },
        message: {
          hasError: false,
          error: ' ',
        },
      },
      messageType: [
        { id: 1, text: 'General Inquiry' },
        { id: 2, text: 'Development' },
        { id: 3, text: 'Design' },
      ],
      navInfo: {
        prev: {
          hasPrev: true,
          linksTo: '/feed/',
          linkText: 'feed',
        },
        next: {
          hasNext: false,
          linksTo: '',
          linkText: '',
        },
        linkColor: 'text-brand',
        iconColor: '#11A89D',
      },
    }
  },
  methods: {
    clearFormErrors(e) {
      for (const item in this.formErrors) {
        if (this.formErrors.hasOwnProperty(item)) {
          this.formErrors[item].hasError = false
          this.formErrors[item].error = ''
        }
      }
    },
    clearError(e) {
      const id = e.target.id

      this.formErrors[id].hasError = false
      this.formErrors[id].error = ''
    },
    resetForm() {
      this.form.category = 0
      this.form.nickname = this.form.email = this.form.contactNo = this.form.message =
        ''
    },
    async sendForm() {
      this.loading = true
      const config = {
        responseType: 'json',
        headers: { 'content-type': 'application/x-www-form-urlencoded' },
      }

      const { data } = await axios.post(
        `${process.env.GRIDSOME_RESOURCE_URL}/message/save`,
        qs.stringify(this.form),
        config
      )

      this.loading = false
      if (data.success) {
        this.clearFormErrors()
        this.resetForm()
      } else {
        if (typeof data.errors !== 'string') {
          for (const item in data.errors) {
            if (this.formErrors.hasOwnProperty(item)) {
              this.formErrors[item].hasError = true
              this.formErrors[item].error = data.errors[item][0]
            }
          }
        }
      }
    },
  },
  mounted() {},
  metaInfo: {
    title: 'Contact',
  },
}
</script>

<style lang="scss"></style>
